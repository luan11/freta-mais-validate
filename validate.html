<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <title>FRETA MAIS - VALIDATE</title>
</head>
<body>

     <select class="form-control" name="hora_saida" id="hora_saida" required="">
          <option value="">Selecione</option>
          <option value="0000">00:00</option>
          <option value="0030">00:30</option>
          <option value="0100">01:00</option>
          <option value="0130">01:30</option>
          <option value="0200">02:00</option>
          <option value="0230">02:30</option>
          <option value="0300">03:00</option>
          <option value="0330">03:30</option>
          <option value="0400">04:00</option>
          <option value="0430">04:30</option>
          <option value="0500">05:00</option>
          <option value="0530">05:30</option>
          <option value="0600">06:00</option>
          <option value="0630">06:30</option>
          <option value="0700">07:00</option>
          <option value="0730">07:30</option>
          <option value="0800">08:00</option>
          <option value="0830">08:30</option>
          <option value="0900">09:00</option>
          <option value="0930">09:30</option>
          <option value="1000">10:00</option>
          <option value="1030">10:30</option>
          <option value="1100">11:00</option>
          <option value="1130">11:30</option>
          <option value="1200">12:00</option>
          <option value="1230">12:30</option>
          <option value="1300">13:00</option>
          <option value="1330">13:30</option>
          <option value="1400">14:00</option>
          <option value="1430">14:30</option>
          <option value="1500">15:00</option>
          <option value="1530">15:30</option>
          <option value="1600">16:00</option>
          <option value="1630">16:30</option>
          <option value="1700">17:00</option>
          <option value="1730">17:30</option>
          <option value="1800">18:00</option>
          <option value="1830">18:30</option>
          <option value="1900">19:00</option>
          <option value="1930">19:30</option>
          <option value="2000">20:00</option>
          <option value="2030">20:30</option>
          <option value="2100">21:00</option>
          <option value="2130">21:30</option>
          <option value="2200">22:00</option>
          <option value="2230">22:30</option>
          <option value="2300">23:00</option>
          <option value="2330">23:30</option>
     </select>

     <select class="form-control" name="hora_retorno" id="hora_retorno" required="">
          <option value="">Selecione</option>
          <option value="0000">00:00</option>
          <option value="0030">00:30</option>
          <option value="0100">01:00</option>
          <option value="0130">01:30</option>
          <option value="0200">02:00</option>
          <option value="0230">02:30</option>
          <option value="0300">03:00</option>
          <option value="0330">03:30</option>
          <option value="0400">04:00</option>
          <option value="0430">04:30</option>
          <option value="0500">05:00</option>
          <option value="0530">05:30</option>
          <option value="0600">06:00</option>
          <option value="0630">06:30</option>
          <option value="0700">07:00</option>
          <option value="0730">07:30</option>
          <option value="0800">08:00</option>
          <option value="0830">08:30</option>
          <option value="0900">09:00</option>
          <option value="0930">09:30</option>
          <option value="1000">10:00</option>
          <option value="1030">10:30</option>
          <option value="1100">11:00</option>
          <option value="1130">11:30</option>
          <option value="1200">12:00</option>
          <option value="1230">12:30</option>
          <option value="1300">13:00</option>
          <option value="1330">13:30</option>
          <option value="1400">14:00</option>
          <option value="1430">14:30</option>
          <option value="1500">15:00</option>
          <option value="1530">15:30</option>
          <option value="1600">16:00</option>
          <option value="1630">16:30</option>
          <option value="1700">17:00</option>
          <option value="1730">17:30</option>
          <option value="1800">18:00</option>
          <option value="1830">18:30</option>
          <option value="1900">19:00</option>
          <option value="1930">19:30</option>
          <option value="2000">20:00</option>
          <option value="2030">20:30</option>
          <option value="2100">21:00</option>
          <option value="2130">21:30</option>
          <option value="2200">22:00</option>
          <option value="2230">22:30</option>
          <option value="2300">23:00</option>
          <option value="2330">23:30</option>
     </select>

     <select id="tipo_diaria" class="form-control" name="daily" required="">
          <option value="">Selecione o tipo da diária</option>
          <option id="meia" value="meia">Meia diária (6 horas)</option>
          <option id="completa" value="completa">Diária Completa (10 horas)</option>
     </select>

     <input id="guarda_valor" type="text" value="" hidden>

     <script src="jquery-3.3.1.min.js"></script>
     <script src="moment.js"></script>
     <script>
          var horaSaida = $('#hora_saida');
          var horaRetorno = $('#hora_retorno');
          var guardaValor = $('#guarda_valor');
          var tipoDiaria_meia = $('#meia');
          var tipoDiaria_completa = $('#completa');
          
          horaSaida.on('change', function(){
               var horarioSaida = horaSaida.val();
               var horaSaida_convertido = convertHours(horarioSaida);
               if (horarioSaida != ""){
                    guardaValor.attr('value',horaSaida_convertido);
               }
          })

          horaRetorno.on('click', function(){
               if (guardaValor.val() == ""){
                    alert("Insira o horário de saída primeiro!");
               }else{
                    horaRetorno.on('change', function(){
                    var horarioRetorno = horaRetorno.val();
                    if (horarioRetorno != ""){
                         var diariaSelecionada = $('#tipo_diaria option:selected').val();
                         var horarioRetorno_convertido = convertHours(horarioRetorno);
                         var horaSaida_valor = guardaValor.val();
                         var diferenciaHoras = subHours(horaSaida_valor,horarioRetorno_convertido);
                         diferenciaHoras = diferenciaHoras.replace(":",".");
                         diferenciaHoras = parseFloat(diferenciaHoras);
                         if (parseFloat(horarioRetorno_convertido.replace(":",".")) == parseFloat(horaSaida_valor.replace(":",".")) && diferenciaHoras == 0){
                                   if (diariaSelecionada == "meia"){
                                        tipoDiaria_meia.removeAttr('selected');
                                        tipoDiaria_completa.removeAttr('disabled');
                                   }
                                   tipoDiaria_meia.attr('disabled','disabled');
                                   tipoDiaria_completa.attr('selected','selected');
                         }else{
                              if (diferenciaHoras > 6){
                                   if (diariaSelecionada == "meia"){
                                        tipoDiaria_meia.removeAttr('selected');
                                        tipoDiaria_completa.removeAttr('disabled');
                                   }
                                   tipoDiaria_meia.attr('disabled','disabled');
                                   tipoDiaria_completa.attr('selected','selected');
                              }
                              if (diferenciaHoras <= 6){
                                   if (diariaSelecionada == "completa"){
                                        tipoDiaria_meia.removeAttr('disabled');
                                        tipoDiaria_completa.removeAttr('selected');
                                   }
                                   tipoDiaria_meia.attr('selected','selected');
                                   tipoDiaria_completa.attr('disabled','disabled');
                              }
                         }
                    }
                    })
               }
          })

          // convert to hours function
          function convertHours(hours){
               hours = moment(hours,"HH:mm");
               hours = hours.format("HH:mm");
               return hours;
          }

          // sub hours function
          function subHours(init,end){
               var newEnd = init.split(":");
               var initSub = moment(end,"HH:mm").subtract({hours: newEnd[0], minutes: newEnd[1]});
               initSub = initSub.format("HH:mm");
               return initSub;
          }     

</script>
</body>
</html>